<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title id="page-title">Post</title>
  <meta name="description" id="meta-desc" content="" />
  <meta property="og:title" content="" id="og-title" />
  <meta property="og:description" content="" id="og-desc" />
  <meta name="twitter:card" content="summary" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module" src="/blog/assets/blog.js" defer></script>
  <script type="module" src="/blog/assets/auth.js" defer></script>
  <link rel="stylesheet" href="/src/Styles.css" />
</head>
<body class="bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100">
  <header class="max-w-4xl mx-auto p-6 flex justify-between items-center">
    <h1 class="text-2xl font-bold"><a href="/">Jeremy Robards</a></h1>
    <div id="auth-ui"></div>
  </header>
  <main class="max-w-4xl mx-auto p-6" id="post-root">
    <article id="post-article" class="prose dark:prose-invert">
      <h1 id="post-title">Title</h1>
      <p id="post-meta" class="text-sm text-gray-600 dark:text-gray-300"></p>
      <div id="post-content"></div>
    </article>
    <nav class="mt-6 flex justify-between" id="nav-links"></nav>
  </main>
  <script type="module">
    import db from './assets/db.js';
    import { hasDevAccess } from './assets/auth.js';
    const rootTitle = document.getElementById('post-title');
    const rootMeta = document.getElementById('post-meta');
    const rootContent = document.getElementById('post-content');
    const nav = document.getElementById('nav-links');
    (async function(){
      // slug from URL (/blog/<slug>/)
      const parts = location.pathname.split('/').filter(Boolean);
      const slug = parts[parts.length-1];
      const posts = await db.getAllPosts();
      const post = (posts||[]).find(p=>p.slug===slug) || posts[0];
      if(!post){ rootContent.innerHTML = '<p>Post not found.</p>'; return; }
      document.title = post.title + ' — Jeremy Robards';
      rootTitle.textContent = post.title; rootMeta.textContent = `${new Date(post.date).toLocaleDateString()} — ${post.author}`;
      rootContent.innerHTML = post.content;
      // admin controls
      if(hasDevAccess()){
        nav.innerHTML = `<div><a href="/blog/editor.html?id=${post.id}" class="text-blue-600">Edit</a> <a href="#" id="delete-post" class="text-red-600 ml-3">Delete</a></div>`;
        document.getElementById('delete-post').addEventListener('click', async (e)=>{ e.preventDefault(); if(!confirm('Delete this post?')) return; post.deleted = true; post.deletedAt = new Date().toISOString(); await db.putPost(post); alert('Moved to recycle (local DB)'); location.href='/blog/'; });
      }
    })();
  </script>
</body>
</html>
